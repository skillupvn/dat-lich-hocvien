<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω H·ªçc Vi√™n H·ªçc Th·ª≠ - Pro Plus</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .header-actions {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
            border: none;
            background: none;
            font-size: 1em;
            white-space: nowrap;
            min-width: 150px;
        }

        .tab:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 8px 15px;
            font-size: 0.9em;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9em;
        }

        .btn-copy {
            background: #6f42c1;
            color: white;
        }

        .btn-copy:hover {
            background: #5a32a3;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .table-actions {
            display: flex;
            gap: 5px;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            background: #667eea;
            color: white;
            border-radius: 12px;
            font-size: 0.85em;
            margin: 2px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            color: #667eea;
            margin: 0;
        }

        .close-modal {
            font-size: 1.5em;
            cursor: pointer;
            color: #6c757d;
            background: none;
            border: none;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            color: #495057;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 2000;
            display: none;
            min-width: 300px;
            max-width: 400px;
        }

        .notification.show {
            display: block;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        .notification.success {
            border-left: 4px solid #28a745;
        }

        .notification.error {
            border-left: 4px solid #dc3545;
        }

        .notification.info {
            border-left: 4px solid #17a2b8;
        }

        .message-box {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
        }

        .copy-section {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .settings-group {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .settings-group h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #28a745;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .export-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .export-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .history-item {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .auto-backup-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .auto-backup-status.active {
            background: #d4edda;
            color: #155724;
        }

        .auto-backup-status.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .appointment-card {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 10px;
            border-radius: 8px;
        }

        .search-bar {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            width: 300px;
            max-width: 100%;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .view-toggle button {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .view-toggle button.active {
            background: #667eea;
            color: white;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 1.8em;
            }

            .header-actions {
                position: static;
                justify-content: center;
                margin-top: 15px;
            }

            .export-buttons {
                grid-template-columns: 1fr;
            }

            .table-container {
                font-size: 0.85em;
            }

            th, td {
                padding: 8px;
            }

            .view-toggle {
                flex-wrap: wrap;
                justify-content: center;
            }

            .search-bar {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-actions">
                <button class="btn btn-warning btn-sm" onclick="createBackup()">üíæ Backup</button>
            </div>
            <h1>üìö Qu·∫£n L√Ω H·ªçc Vi√™n H·ªçc Th·ª≠ Pro Plus</h1>
            <p>H·ªá th·ªëng qu·∫£n l√Ω v·ªõi Excel, Backup & Ch·ªânh s·ª≠a n√¢ng cao</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">üìä T·ªïng Quan</button>
            <button class="tab" onclick="switchTab('add-student')">‚ûï Th√™m H·ªçc Vi√™n</button>
            <button class="tab" onclick="switchTab('students')">üë• Danh S√°ch H·ªçc Vi√™n</button>
            <button class="tab" onclick="switchTab('appointments')">üìÖ L·ªãch H·∫πn</button>
            <button class="tab" onclick="switchTab('export')">üì§ Xu·∫•t D·ªØ Li·ªáu</button>
            <button class="tab" onclick="switchTab('settings')">‚öôÔ∏è C√†i ƒê·∫∑t</button>
        </div>

        <div class="content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2 style="margin-bottom: 20px; color: #495057;">T·ªïng Quan H·ªá Th·ªëng</h2>
                <div class="stats" id="stats"></div>
                <h3 style="margin-top: 30px; margin-bottom: 15px; color: #495057;">L·ªãch H·∫πn S·∫Øp T·ªõi</h3>
                <div id="upcoming-appointments"></div>
            </div>

            <!-- Add Student Tab -->
            <div id="add-student" class="tab-content">
                <h2 style="margin-bottom: 20px; color: #495057;">‚ûï Th√™m H·ªçc Vi√™n M·ªõi</h2>
                <form id="student-form">
                    <input type="hidden" id="editStudentId">
                    <div class="form-row">
                        <div class="form-group">
                            <label>T√™n H·ªçc Vi√™n *</label>
                            <input type="text" id="studentName" required placeholder="Nh·∫≠p t√™n h·ªçc vi√™n">
                        </div>
                        <div class="form-group">
                            <label>Tu·ªïi *</label>
                            <input type="number" id="studentAge" required placeholder="Nh·∫≠p tu·ªïi" min="3" max="18">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>T√™n Ph·ª• Huynh *</label>
                            <input type="text" id="parentName" required placeholder="Nh·∫≠p t√™n ph·ª• huynh">
                        </div>
                        <div class="form-group">
                            <label>S·ªë ƒêi·ªán Tho·∫°i *</label>
                            <input type="tel" id="parentPhone" required placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Email Ph·ª• Huynh</label>
                        <input type="email" id="parentEmail" placeholder="Nh·∫≠p email (t√πy ch·ªçn)">
                    </div>

                    <div class="form-group">
                        <label>M√¥n H·ªçc Quan T√¢m *</label>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" name="subject" value="C·ªù Vua" style="width: auto;">
                                ‚ôüÔ∏è C·ªù Vua
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" name="subject" value="V·∫Ω Tranh" style="width: auto;">
                                üé® V·∫Ω Tranh
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" name="subject" value="Ti·ªÅn Ti·ªÉu H·ªçc" style="width: auto;">
                                üìñ Ti·ªÅn Ti·ªÉu H·ªçc
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" name="subject" value="R√®n Ch·ªØ" style="width: auto;">
                                ‚úçÔ∏è R√®n Ch·ªØ
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Ghi Ch√∫</label>
                        <textarea id="notes" rows="3" placeholder="Nh·∫≠p ghi ch√∫ b·ªï sung (t√πy ch·ªçn)"></textarea>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-primary" id="submitBtn">üíæ L∆∞u H·ªçc Vi√™n</button>
                        <button type="button" class="btn btn-warning" id="cancelEditBtn" style="display: none;" onclick="cancelEdit()">‚ùå H·ªßy Ch·ªânh S·ª≠a</button>
                    </div>
                </form>
            </div>

            <!-- Students List Tab -->
            <div id="students" class="tab-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                    <h2 style="color: #495057;">üë• Danh S√°ch H·ªçc Vi√™n</h2>
                    <input type="text" id="searchStudent" class="search-bar" placeholder="üîç T√¨m ki·∫øm h·ªçc vi√™n...">
                </div>
                <div id="students-list"></div>
            </div>

            <!-- Appointments Tab -->
            <div id="appointments" class="tab-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                    <h2 style="color: #495057;">üìÖ Qu·∫£n L√Ω L·ªãch H·∫πn</h2>
                    <input type="text" id="searchAppointment" class="search-bar" placeholder="üîç T√¨m ki·∫øm l·ªãch h·∫πn...">
                </div>
                <div id="appointments-list"></div>
            </div>

            <!-- Export Tab -->
            <div id="export" class="tab-content">
                <h2 style="margin-bottom: 20px; color: #495057;">üì§ Xu·∫•t D·ªØ Li·ªáu Excel</h2>
                
                <div class="export-section">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üìä Xu·∫•t B√°o C√°o Excel</h3>
                    <p style="color: #6c757d; margin-bottom: 15px;">
                        Xu·∫•t to√†n b·ªô d·ªØ li·ªáu h·ªçc vi√™n v√† l·ªãch h·∫πn sang file Excel ƒë·ªÉ l∆∞u tr·ªØ ho·∫∑c b√°o c√°o.
                    </p>
                    <div class="export-buttons">
                        <button class="btn btn-success" onclick="exportAllToExcel()">
                            üìä Xu·∫•t T·∫•t C·∫£ (Excel)
                        </button>
                        <button class="btn btn-info" onclick="exportStudentsToExcel()">
                            üë• Xu·∫•t Danh S√°ch H·ªçc Vi√™n
                        </button>
                        <button class="btn btn-warning" onclick="exportAppointmentsToExcel()">
                            üìÖ Xu·∫•t L·ªãch H·∫πn
                        </button>
                        <button class="btn btn-primary" onclick="exportDetailedReport()">
                            üìã B√°o C√°o Chi Ti·∫øt
                        </button>
                    </div>
                </div>

                <div class="export-section">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üíæ Sao L∆∞u & Kh√¥i Ph·ª•c</h3>
                    <p style="color: #6c757d; margin-bottom: 15px;">
                        Sao l∆∞u d·ªØ li·ªáu d∆∞·ªõi d·∫°ng JSON ƒë·ªÉ kh√¥i ph·ª•c sau n√†y.
                    </p>
                    <div class="export-buttons">
                        <button class="btn btn-success" onclick="exportBackupJSON()">
                            üíæ T·∫£i Backup JSON
                        </button>
                        <div class="file-input-wrapper">
                            <button class="btn btn-info">üìÅ Kh√¥i Ph·ª•c T·ª´ JSON</button>
                            <input type="file" id="restoreFile" accept=".json" onchange="restoreFromJSON(event)">
                        </div>
                    </div>
                </div>

                <div class="export-section">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üìà Th·ªëng K√™</h3>
                    <div id="export-stats"></div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <h2 style="margin-bottom: 20px; color: #495057;">‚öôÔ∏è C√†i ƒê·∫∑t</h2>
                
                <div class="settings-group">
                    <h3>üîÑ Sao L∆∞u T·ª± ƒê·ªông</h3>
                    <p style="color: #6c757d; margin-bottom: 15px;">
                        T·ª± ƒë·ªông sao l∆∞u d·ªØ li·ªáu sau m·ªói thay ƒë·ªïi quan tr·ªçng
                    </p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>B·∫≠t sao l∆∞u t·ª± ƒë·ªông</span>
                        <label class="switch">
                            <input type="checkbox" id="autoBackupToggle" onchange="toggleAutoBackup()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div style="margin-top: 15px;">
                        <span class="auto-backup-status" id="backupStatus">Ch∆∞a k√≠ch ho·∫°t</span>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>üìú L·ªãch S·ª≠ Backup</h3>
                    <p style="color: #6c757d; margin-bottom: 15px;">
                        5 b·∫£n sao l∆∞u g·∫ßn nh·∫•t
                    </p>
                    <div id="backup-history"></div>
                </div>

                <div class="settings-group">
                    <h3>üóëÔ∏è X√≥a D·ªØ Li·ªáu</h3>
                    <p style="color: #6c757d; margin-bottom: 15px;">
                        <strong>C·∫£nh b√°o:</strong> H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!
                    </p>
                    <button class="btn btn-danger" onclick="clearAllData()">
                        üóëÔ∏è X√≥a To√†n B·ªô D·ªØ Li·ªáu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Appointment -->
    <div id="appointmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìÖ ƒê·∫∑t L·ªãch H·∫πn</h2>
                <button class="close-modal" onclick="closeAppointmentModal()">&times;</button>
            </div>
            <form id="appointment-form">
                <input type="hidden" id="appointmentStudentId">
                <input type="hidden" id="editAppointmentId">
                <div class="form-group">
                    <label>H·ªçc Vi√™n</label>
                    <input type="text" id="appointmentStudentName" readonly style="background: #f8f9fa;">
                </div>
                <div class="form-group">
                    <label>M√¥n H·ªçc *</label>
                    <select id="appointmentSubject" required>
                        <option value="">Ch·ªçn m√¥n h·ªçc</option>
                        <option value="C·ªù Vua">‚ôüÔ∏è C·ªù Vua</option>
                        <option value="V·∫Ω Tranh">üé® V·∫Ω Tranh</option>
                        <option value="Ti·ªÅn Ti·ªÉu H·ªçc">üìñ Ti·ªÅn Ti·ªÉu H·ªçc</option>
                        <option value="R√®n Ch·ªØ">‚úçÔ∏è R√®n Ch·ªØ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ng√†y H·∫πn *</label>
                    <input type="date" id="appointmentDate" required>
                </div>
                <div class="form-group">
                    <label>Gi·ªù H·∫πn *</label>
                    <input type="time" id="appointmentTime" required>
                </div>
                <div class="form-group">
                    <label>Ghi Ch√∫</label>
                    <textarea id="appointmentNotes" rows="3" placeholder="Nh·∫≠p ghi ch√∫ v·ªÅ bu·ªïi h·ªçc th·ª≠"></textarea>
                </div>
                <button type="submit" class="btn btn-success" id="appointmentSubmitBtn">‚úÖ T·∫°o L·ªãch H·∫πn</button>
            </form>
        </div>
    </div>

    <!-- Modal for Notification Message -->
    <div id="notificationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì® Th√¥ng B√°o G·ª≠i Ph·ª• Huynh</h2>
                <button class="close-modal" onclick="closeNotificationModal()">&times;</button>
            </div>
            <p style="color: #6c757d; margin-bottom: 15px;">
                Copy n·ªôi dung b√™n d∆∞·ªõi ƒë·ªÉ g·ª≠i cho ph·ª• huynh qua SMS/Zalo/Messenger
            </p>
            <div class="message-box" id="notificationMessage"></div>
            <div class="copy-section">
                <button class="btn btn-copy" onclick="copyNotification()">
                    üìã Copy To√†n B·ªô
                </button>
                <button class="btn btn-success" onclick="closeNotificationModal()">
                    ‚úÖ ƒê√£ Copy
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="notification"></div>

    <script>
        // Data Storage
        let students = JSON.parse(localStorage.getItem('students')) || [];
        let appointments = JSON.parse(localStorage.getItem('appointments')) || [];
        let backupHistory = JSON.parse(localStorage.getItem('backupHistory')) || [];
        let autoBackupEnabled = localStorage.getItem('autoBackupEnabled') === 'true';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderAll();
            updateBackupStatus();
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('appointmentDate').min = today;
            document.getElementById('autoBackupToggle').checked = autoBackupEnabled;
        });

        // Notification System
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.className = `notification ${type} show`;
            notification.innerHTML = `
                <strong>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</strong>
                <p style="margin-top: 5px;">${message}</p>
            `;
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Auto Backup System
        function createAutoBackup() {
            if (!autoBackupEnabled) return;
            
            const backup = {
                id: Date.now(),
                date: new Date().toISOString(),
                students: students,
                appointments: appointments,
                type: 'auto'
            };

            backupHistory.unshift(backup);
            if (backupHistory.length > 10) {
                backupHistory = backupHistory.slice(0, 10);
            }

            localStorage.setItem('backupHistory', JSON.stringify(backupHistory));
        }

        function toggleAutoBackup() {
            autoBackupEnabled = document.getElementById('autoBackupToggle').checked;
            localStorage.setItem('autoBackupEnabled', autoBackupEnabled);
            updateBackupStatus();
            
            if (autoBackupEnabled) {
                createAutoBackup();
                showNotification('ƒê√£ b·∫≠t sao l∆∞u t·ª± ƒë·ªông', 'success');
            } else {
                showNotification('ƒê√£ t·∫Øt sao l∆∞u t·ª± ƒë·ªông', 'info');
            }
        }

        function updateBackupStatus() {
            const status = document.getElementById('backupStatus');
            if (autoBackupEnabled) {
                status.className = 'auto-backup-status active';
                status.textContent = '‚úÖ ƒêang ho·∫°t ƒë·ªông';
            } else {
                status.className = 'auto-backup-status inactive';
                status.textContent = '‚ùå Ch∆∞a k√≠ch ho·∫°t';
            }
        }

        function renderBackupHistory() {
            const container = document.getElementById('backup-history');
            
            if (backupHistory.length === 0) {
                container.innerHTML = '<p style="color: #6c757d;">Ch∆∞a c√≥ b·∫£n backup n√†o</p>';
                return;
            }

            const html = backupHistory.slice(0, 5).map((backup, index) => `
                <div class="history-item">
                    <div>
                        <strong>${backup.type === 'auto' ? 'üîÑ T·ª± ƒë·ªông' : 'üíæ Th·ªß c√¥ng'}</strong><br>
                        <small style="color: #6c757d;">${formatDateTime(backup.date)}</small><br>
                        <small>H·ªçc vi√™n: ${backup.students.length} | L·ªãch h·∫πn: ${backup.appointments.length}</small>
                    </div>
                    <button class="btn btn-info btn-sm" onclick="restoreFromHistory(${index})">
                        ‚Ü©Ô∏è Kh√¥i ph·ª•c
                    </button>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function restoreFromHistory(index) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën kh√¥i ph·ª•c d·ªØ li·ªáu t·ª´ b·∫£n backup n√†y? D·ªØ li·ªáu hi·ªán t·∫°i s·∫Ω b·ªã ghi ƒë√®!')) return;

            const backup = backupHistory[index];
            students = backup.students;
            appointments = backup.appointments;

            localStorage.setItem('students', JSON.stringify(students));
            localStorage.setItem('appointments', JSON.stringify(appointments));

            renderAll();
            showNotification('‚úÖ ƒê√£ kh√¥i ph·ª•c d·ªØ li·ªáu th√†nh c√¥ng!', 'success');
        }

        function createBackup() {
            const backup = {
                id: Date.now(),
                date: new Date().toISOString(),
                students: students,
                appointments: appointments,
                type: 'manual'
            };

            backupHistory.unshift(backup);
            if (backupHistory.length > 10) {
                backupHistory = backupHistory.slice(0, 10);
            }

            localStorage.setItem('backupHistory', JSON.stringify(backupHistory));
            renderBackupHistory();
            showNotification('‚úÖ ƒê√£ t·∫°o b·∫£n backup th·ªß c√¥ng!', 'success');
        }

        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') renderDashboard();
            if (tabName === 'students') renderStudentsList();
            if (tabName === 'appointments') renderAppointmentsList();
            if (tabName === 'export') renderExportStats();
            if (tabName === 'settings') renderBackupHistory();
        }

        // Student Form Submit
        document.getElementById('student-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const subjects = Array.from(document.querySelectorAll('input[name="subject"]:checked'))
                .map(cb => cb.value);

            if (subjects.length === 0) {
                showNotification('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt m√¥n h·ªçc!', 'error');
                return;
            }

            const editId = document.getElementById('editStudentId').value;
            
            if (editId) {
                // Edit existing student
                const index = students.findIndex(s => s.id == editId);
                if (index !== -1) {
                    students[index] = {
                        ...students[index],
                        name: document.getElementById('studentName').value,
                        age: document.getElementById('studentAge').value,
                        parentName: document.getElementById('parentName').value,
                        parentPhone: document.getElementById('parentPhone').value,
                        parentEmail: document.getElementById('parentEmail').value,
                        subjects: subjects,
                        notes: document.getElementById('notes').value,
                        updatedAt: new Date().toISOString()
                    };
                    showNotification('‚úÖ C·∫≠p nh·∫≠t h·ªçc vi√™n th√†nh c√¥ng!', 'success');
                }
            } else {
                // Add new student
                const student = {
                    id: Date.now(),
                    name: document.getElementById('studentName').value,
                    age: document.getElementById('studentAge').value,
                    parentName: document.getElementById('parentName').value,
                    parentPhone: document.getElementById('parentPhone').value,
                    parentEmail: document.getElementById('parentEmail').value,
                    subjects: subjects,
                    notes: document.getElementById('notes').value,
                    createdAt: new Date().toISOString()
                };
                students.push(student);
                showNotification('‚úÖ Th√™m h·ªçc vi√™n th√†nh c√¥ng!', 'success');
            }

            localStorage.setItem('students', JSON.stringify(students));
            createAutoBackup();

            this.reset();
            cancelEdit();
            renderAll();
        });

        function editStudent(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;

            document.getElementById('editStudentId').value = student.id;
            document.getElementById('studentName').value = student.name;
            document.getElementById('studentAge').value = student.age;
            document.getElementById('parentName').value = student.parentName;
            document.getElementById('parentPhone').value = student.parentPhone;
            document.getElementById('parentEmail').value = student.parentEmail || '';
            document.getElementById('notes').value = student.notes || '';

            // Check subjects
            document.querySelectorAll('input[name="subject"]').forEach(cb => {
                cb.checked = student.subjects.includes(cb.value);
            });

            document.getElementById('submitBtn').textContent = 'üíæ C·∫≠p Nh·∫≠t H·ªçc Vi√™n';
            document.getElementById('cancelEditBtn').style.display = 'inline-flex';

            // Switch to form tab
            switchTab('add-student');
            document.querySelector('.tab[onclick*="add-student"]').click();
            window.scrollTo(0, 0);
        }

        function cancelEdit() {
            document.getElementById('editStudentId').value = '';
            document.getElementById('submitBtn').textContent = 'üíæ L∆∞u H·ªçc Vi√™n';
            document.getElementById('cancelEditBtn').style.display = 'none';
        }

        // Render Functions
        function renderAll() {
            renderDashboard();
            renderStudentsList();
            renderAppointmentsList();
            renderExportStats();
            renderBackupHistory();
        }

        function renderDashboard() {
            const statsHtml = `
                <div class="stat-card">
                    <h3>${students.length}</h3>
                    <p>T·ªïng H·ªçc Vi√™n</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <h3>${appointments.length}</h3>
                    <p>T·ªïng L·ªãch H·∫πn</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <h3>${getUpcomingAppointments().length}</h3>
                    <p>L·ªãch S·∫Øp T·ªõi</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <h3>${backupHistory.length}</h3>
                    <p>B·∫£n Backup</p>
                </div>
            `;
            document.getElementById('stats').innerHTML = statsHtml;

            const upcoming = getUpcomingAppointments().slice(0, 5);
            const upcomingHtml = upcoming.length > 0 
                ? upcoming.map(apt => {
                    const student = students.find(s => s.id === apt.studentId);
                    return `
                        <div class="appointment-card">
                            <strong>üë§ ${student?.name || 'N/A'}</strong> - 
                            <strong>${apt.subject}</strong><br>
                            üìÖ ${formatDate(apt.date)} l√∫c ${apt.time}<br>
                            üìû ${student?.parentPhone || 'N/A'}
                        </div>
                    `;
                }).join('')
                : '<div class="empty-state"><p>Ch∆∞a c√≥ l·ªãch h·∫πn n√†o s·∫Øp t·ªõi</p></div>';
            
            document.getElementById('upcoming-appointments').innerHTML = upcomingHtml;
        }

        function renderStudentsList() {
            const container = document.getElementById('students-list');
            
            if (students.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p style="font-size: 3em;">üìã</p>
                        <h3>Ch∆∞a c√≥ h·ªçc vi√™n n√†o</h3>
                        <p>H√£y th√™m h·ªçc vi√™n m·ªõi t·ª´ tab "Th√™m H·ªçc Vi√™n"</p>
                    </div>
                `;
                return;
            }

            const html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>T√™n H·ªçc Vi√™n</th>
                                <th>Tu·ªïi</th>
                                <th>Ph·ª• Huynh</th>
                                <th>S·ªë ƒêi·ªán Tho·∫°i</th>
                                <th>Email</th>
                                <th>M√¥n H·ªçc</th>
                                <th>L·ªãch H·∫πn</th>
                                <th>Thao T√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${students.map(student => {
                                const studentAppointments = appointments.filter(a => a.studentId === student.id);
                                return `
                                    <tr>
                                        <td><strong>${student.name}</strong></td>
                                        <td>${student.age}</td>
                                        <td>${student.parentName}</td>
                                        <td>${student.parentPhone}</td>
                                        <td>${student.parentEmail || '-'}</td>
                                        <td>${student.subjects.map(s => `<span class="badge">${s}</span>`).join('')}</td>
                                        <td><strong>${studentAppointments.length}</strong> l·ªãch</td>
                                        <td>
                                            <div class="table-actions">
                                                <button class="btn btn-info btn-sm" onclick="editStudent(${student.id})" title="S·ª≠a">‚úèÔ∏è</button>
                                                <button class="btn btn-success btn-sm" onclick="openAppointmentModal(${student.id})" title="ƒê·∫∑t l·ªãch">üìÖ</button>
                                                <button class="btn btn-danger btn-sm" onclick="deleteStudent(${student.id})" title="X√≥a">üóëÔ∏è</button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;

            container.innerHTML = html;
        }

        // Search Students
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchStudent');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const filtered = students.filter(s => 
                        s.name.toLowerCase().includes(searchTerm) ||
                        s.parentName.toLowerCase().includes(searchTerm) ||
                        s.parentPhone.includes(searchTerm) ||
                        s.subjects.some(sub => sub.toLowerCase().includes(searchTerm))
                    );
                    
                    const container = document.getElementById('students-list');
                    if (filtered.length === 0) {
                        container.innerHTML = '<div class="empty-state"><p>Kh√¥ng t√¨m th·∫•y h·ªçc vi√™n n√†o</p></div>';
                        return;
                    }
                    
                    const html = `
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>T√™n H·ªçc Vi√™n</th>
                                        <th>Tu·ªïi</th>
                                        <th>Ph·ª• Huynh</th>
                                        <th>S·ªë ƒêi·ªán Tho·∫°i</th>
                                        <th>Email</th>
                                        <th>M√¥n H·ªçc</th>
                                        <th>L·ªãch H·∫πn</th>
                                        <th>Thao T√°c</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${filtered.map(student => {
                                        const studentAppointments = appointments.filter(a => a.studentId === student.id);
                                        return `
                                            <tr>
                                                <td><strong>${student.name}</strong></td>
                                                <td>${student.age}</td>
                                                <td>${student.parentName}</td>
                                                <td>${student.parentPhone}</td>
                                                <td>${student.parentEmail || '-'}</td>
                                                <td>${student.subjects.map(s => `<span class="badge">${s}</span>`).join('')}</td>
                                                <td><strong>${studentAppointments.length}</strong> l·ªãch</td>
                                                <td>
                                                    <div class="table-actions">
                                                        <button class="btn btn-info btn-sm" onclick="editStudent(${student.id})">‚úèÔ∏è</button>
                                                        <button class="btn btn-success btn-sm" onclick="openAppointmentModal(${student.id})">üìÖ</button>
                                                        <button class="btn btn-danger btn-sm" onclick="deleteStudent(${student.id})">üóëÔ∏è</button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    container.innerHTML = html;
                });
            }
        });

        // Appointment Modal
        function openAppointmentModal(studentId, appointmentId = null) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;

            document.getElementById('appointmentStudentId').value = studentId;
            document.getElementById('appointmentStudentName').value = student.name;
            
            if (appointmentId) {
                // Edit mode
                const apt = appointments.find(a => a.id === appointmentId);
                if (apt) {
                    document.getElementById('editAppointmentId').value = appointmentId;
                    document.getElementById('appointmentSubject').value = apt.subject;
                    document.getElementById('appointmentDate').value = apt.date;
                    document.getElementById('appointmentTime').value = apt.time;
                    document.getElementById('appointmentNotes').value = apt.notes || '';
                    document.getElementById('appointmentSubmitBtn').textContent = '‚úÖ C·∫≠p Nh·∫≠t L·ªãch H·∫πn';
                }
            } else {
                // Add mode
                document.getElementById('editAppointmentId').value = '';
                document.getElementById('appointment-form').reset();
                document.getElementById('appointmentStudentName').value = student.name;
                document.getElementById('appointmentSubmitBtn').textContent = '‚úÖ T·∫°o L·ªãch H·∫πn';
            }
            
            document.getElementById('appointmentModal').classList.add('active');
        }

        function closeAppointmentModal() {
            document.getElementById('appointmentModal').classList.remove('active');
            document.getElementById('appointment-form').reset();
            document.getElementById('editAppointmentId').value = '';
        }

        // Appointment Form Submit
        document.getElementById('appointment-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const studentId = parseInt(document.getElementById('appointmentStudentId').value);
            const student = students.find(s => s.id === studentId);
            const editId = document.getElementById('editAppointmentId').value;

            const appointmentData = {
                studentId: studentId,
                subject: document.getElementById('appointmentSubject').value,
                date: document.getElementById('appointmentDate').value,
                time: document.getElementById('appointmentTime').value,
                notes: document.getElementById('appointmentNotes').value
            };

            if (editId) {
                // Edit existing appointment
                const index = appointments.findIndex(a => a.id == editId);
                if (index !== -1) {
                    appointments[index] = {
                        ...appointments[index],
                        ...appointmentData,
                        updatedAt: new Date().toISOString()
                    };
                    showNotification('‚úÖ C·∫≠p nh·∫≠t l·ªãch h·∫πn th√†nh c√¥ng!', 'success');
                }
            } else {
                // Create new appointment
                const appointment = {
                    id: Date.now(),
                    ...appointmentData,
                    createdAt: new Date().toISOString()
                };
                appointments.push(appointment);
            }

            localStorage.setItem('appointments', JSON.stringify(appointments));
            createAutoBackup();

            // Show notification with copy button
            const message = `üìÖ TH√îNG B√ÅO L·ªäCH H·ªåC TH·ª¨

K√≠nh g·ª≠i ph·ª• huynh: ${student.parentName}

Ch√∫ng t√¥i xin th√¥ng b√°o l·ªãch h·ªçc th·ª≠ cho b√© ${student.name}:

üìö M√¥n h·ªçc: ${appointmentData.subject}
üìÖ Ng√†y: ${formatDate(appointmentData.date)}
‚è∞ Gi·ªù: ${appointmentData.time}
${appointmentData.notes ? `üìù Ghi ch√∫: ${appointmentData.notes}` : ''}

Vui l√≤ng ƒë·∫øn ƒë√∫ng gi·ªù. C·∫£m ∆°n qu√Ω ph·ª• huynh!

üìû Li√™n h·ªá: ${student.parentPhone}`;

            showNotificationMessage(message);
            closeAppointmentModal();
            renderAll();
        });

        function showNotificationMessage(message) {
            document.getElementById('notificationMessage').textContent = message;
            document.getElementById('notificationModal').classList.add('active');
        }

        function closeNotificationModal() {
            document.getElementById('notificationModal').classList.remove('active');
        }

        function copyNotification() {
            const message = document.getElementById('notificationMessage').textContent;
            navigator.clipboard.writeText(message).then(() => {
                showNotification('‚úÖ ƒê√£ copy th√¥ng b√°o v√†o clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = message;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('‚úÖ ƒê√£ copy th√¥ng b√°o!', 'success');
            });
        }

        function renderAppointmentsList() {
            const container = document.getElementById('appointments-list');
            
            if (appointments.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p style="font-size: 3em;">üìÖ</p>
                        <h3>Ch∆∞a c√≥ l·ªãch h·∫πn n√†o</h3>
                        <p>H√£y ƒë·∫∑t l·ªãch h·∫πn cho h·ªçc vi√™n t·ª´ tab "Danh S√°ch H·ªçc Vi√™n"</p>
                    </div>
                `;
                return;
            }

            const sortedAppointments = [...appointments].sort((a, b) => {
                return new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time);
            });

            const html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Tr·∫°ng Th√°i</th>
                                <th>H·ªçc Vi√™n</th>
                                <th>Ph·ª• Huynh</th>
                                <th>S·ªë ƒêi·ªán Tho·∫°i</th>
                                <th>M√¥n H·ªçc</th>
                                <th>Ng√†y H·∫πn</th>
                                <th>Gi·ªù H·∫πn</th>
                                <th>Ghi Ch√∫</th>
                                <th>Thao T√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sortedAppointments.map(apt => {
                                const student = students.find(s => s.id === apt.studentId);
                                const isPast = new Date(apt.date + ' ' + apt.time) < new Date();
                                return `
                                    <tr style="background: ${isPast ? '#f8f9fa' : 'white'};">
                                        <td>${isPast ? '‚úÖ ƒê√£ qua' : 'üìÖ S·∫Øp t·ªõi'}</td>
                                        <td><strong>${student?.name || 'N/A'}</strong></td>
                                        <td>${student?.parentName || 'N/A'}</td>
                                        <td>${student?.parentPhone || 'N/A'}</td>
                                        <td><span class="badge">${apt.subject}</span></td>
                                        <td>${formatDate(apt.date)}</td>
                                        <td><strong>${apt.time}</strong></td>
                                        <td>${apt.notes || '-'}</td>
                                        <td>
                                            <div class="table-actions">
                                                <button class="btn btn-info btn-sm" onclick="editAppointment(${apt.id})" title="S·ª≠a">‚úèÔ∏è</button>
                                                <button class="btn btn-copy btn-sm" onclick="resendNotification(${apt.id})" title="G·ª≠i l·∫°i">üì®</button>
                                                <button class="btn btn-danger btn-sm" onclick="deleteAppointment(${apt.id})" title="X√≥a">üóëÔ∏è</button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;

            container.innerHTML = html;
        }

        // Search Appointments
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchAppointment');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const filtered = appointments.filter(apt => {
                        const student = students.find(s => s.id === apt.studentId);
                        return student?.name.toLowerCase().includes(searchTerm) ||
                               student?.parentName.toLowerCase().includes(searchTerm) ||
                               student?.parentPhone.includes(searchTerm) ||
                               apt.subject.toLowerCase().includes(searchTerm) ||
                               apt.date.includes(searchTerm);
                    });
                    
                    const container = document.getElementById('appointments-list');
                    if (filtered.length === 0) {
                        container.innerHTML = '<div class="empty-state"><p>Kh√¥ng t√¨m th·∫•y l·ªãch h·∫πn n√†o</p></div>';
                        return;
                    }
                    
                    const sortedFiltered = [...filtered].sort((a, b) => {
                        return new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time);
                    });

                    const html = `
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Tr·∫°ng Th√°i</th>
                                        <th>H·ªçc Vi√™n</th>
                                        <th>Ph·ª• Huynh</th>
                                        <th>S·ªë ƒêi·ªán Tho·∫°i</th>
                                        <th>M√¥n H·ªçc</th>
                                        <th>Ng√†y H·∫πn</th>
                                        <th>Gi·ªù H·∫πn</th>
                                        <th>Ghi Ch√∫</th>
                                        <th>Thao T√°c</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${sortedFiltered.map(apt => {
                                        const student = students.find(s => s.id === apt.studentId);
                                        const isPast = new Date(apt.date + ' ' + apt.time) < new Date();
                                        return `
                                            <tr style="background: ${isPast ? '#f8f9fa' : 'white'};">
                                                <td>${isPast ? '‚úÖ ƒê√£ qua' : 'üìÖ S·∫Øp t·ªõi'}</td>
                                                <td><strong>${student?.name || 'N/A'}</strong></td>
                                                <td>${student?.parentName || 'N/A'}</td>
                                                <td>${student?.parentPhone || 'N/A'}</td>
                                                <td><span class="badge">${apt.subject}</span></td>
                                                <td>${formatDate(apt.date)}</td>
                                                <td><strong>${apt.time}</strong></td>
                                                <td>${apt.notes || '-'}</td>
                                                <td>
                                                    <div class="table-actions">
                                                        <button class="btn btn-info btn-sm" onclick="editAppointment(${apt.id})">‚úèÔ∏è</button>
                                                        <button class="btn btn-copy btn-sm" onclick="resendNotification(${apt.id})">üì®</button>
                                                        <button class="btn btn-danger btn-sm" onclick="deleteAppointment(${apt.id})">üóëÔ∏è</button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    container.innerHTML = html;
                });
            }
        });

        function editAppointment(appointmentId) {
            const apt = appointments.find(a => a.id === appointmentId);
            if (!apt) return;
            
            openAppointmentModal(apt.studentId, appointmentId);
        }

        function resendNotification(appointmentId) {
            const apt = appointments.find(a => a.id === appointmentId);
            const student = students.find(s => s.id === apt.studentId);

            if (!apt || !student) {
                showNotification('Kh√¥ng t√¨m th·∫•y th√¥ng tin!', 'error');
                return;
            }

            const message = `üìÖ TH√îNG B√ÅO L·ªäCH H·ªåC TH·ª¨

K√≠nh g·ª≠i ph·ª• huynh: ${student.parentName}

Ch√∫ng t√¥i xin nh·∫Øc l·∫°i l·ªãch h·ªçc th·ª≠ cho b√© ${student.name}:

üìö M√¥n h·ªçc: ${apt.subject}
üìÖ Ng√†y: ${formatDate(apt.date)}
‚è∞ Gi·ªù: ${apt.time}
${apt.notes ? `üìù Ghi ch√∫: ${apt.notes}` : ''}

Vui l√≤ng ƒë·∫øn ƒë√∫ng gi·ªù. C·∫£m ∆°n qu√Ω ph·ª• huynh!

üìû Li√™n h·ªá: ${student.parentPhone}`;

            showNotificationMessage(message);
        }

        function deleteStudent(studentId) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a h·ªçc vi√™n n√†y? T·∫•t c·∫£ l·ªãch h·∫πn c·ªßa h·ªçc vi√™n c≈©ng s·∫Ω b·ªã x√≥a!')) return;

            students = students.filter(s => s.id !== studentId);
            appointments = appointments.filter(a => a.studentId !== studentId);
            
            localStorage.setItem('students', JSON.stringify(students));
            localStorage.setItem('appointments', JSON.stringify(appointments));
            createAutoBackup();

            renderAll();
            showNotification('‚úÖ ƒê√£ x√≥a h·ªçc vi√™n!', 'success');
        }

        function deleteAppointment(appointmentId) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a l·ªãch h·∫πn n√†y?')) return;

            appointments = appointments.filter(a => a.id !== appointmentId);
            localStorage.setItem('appointments', JSON.stringify(appointments));
            createAutoBackup();

            renderAll();
            showNotification('‚úÖ ƒê√£ x√≥a l·ªãch h·∫πn!', 'success');
        }

        // Export Functions
        function renderExportStats() {
            const subjectStats = {};
            students.forEach(s => {
                s.subjects.forEach(subject => {
                    subjectStats[subject] = (subjectStats[subject] || 0) + 1;
                });
            });

            const html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    ${Object.entries(subjectStats).map(([subject, count]) => `
                        <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #e9ecef;">
                            <strong style="color: #667eea;">${subject}</strong><br>
                            <span style="font-size: 1.5em;">${count}</span> h·ªçc vi√™n
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px; border: 2px solid #e9ecef;">
                    <strong>üìä T·ªïng quan:</strong><br>
                    ‚Ä¢ T·ªïng h·ªçc vi√™n: ${students.length}<br>
                    ‚Ä¢ T·ªïng l·ªãch h·∫πn: ${appointments.length}<br>
                    ‚Ä¢ L·ªãch h·∫πn s·∫Øp t·ªõi: ${getUpcomingAppointments().length}<br>
                    ‚Ä¢ L·ªãch h·∫πn ƒë√£ qua: ${appointments.length - getUpcomingAppointments().length}
                </div>
            `;

            document.getElementById('export-stats').innerHTML = html;
        }

        function exportAllToExcel() {
            if (students.length === 0 && appointments.length === 0) {
                showNotification('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t!', 'error');
                return;
            }

            const wb = XLSX.utils.book_new();

            // Students Sheet
            const studentsData = students.map(s => ({
                'T√™n h·ªçc vi√™n': s.name,
                'Tu·ªïi': s.age,
                'Ph·ª• huynh': s.parentName,
                'S·ªë ƒëi·ªán tho·∫°i': s.parentPhone,
                'Email': s.parentEmail || '',
                'M√¥n h·ªçc': s.subjects.join(', '),
                'S·ªë l·ªãch h·∫πn': appointments.filter(a => a.studentId === s.id).length,
                'Ghi ch√∫': s.notes || '',
                'Ng√†y t·∫°o': formatDateTime(s.createdAt)
            }));
            const ws1 = XLSX.utils.json_to_sheet(studentsData);
            XLSX.utils.book_append_sheet(wb, ws1, 'Danh S√°ch H·ªçc Vi√™n');

            // Appointments Sheet
            const appointmentsData = appointments.map(a => {
                const student = students.find(s => s.id === a.studentId);
                const isPast = new Date(a.date + ' ' + a.time) < new Date();
                return {
                    'H·ªçc vi√™n': student?.name || 'N/A',
                    'Ph·ª• huynh': student?.parentName || 'N/A',
                    'S·ªë ƒëi·ªán tho·∫°i': student?.parentPhone || 'N/A',
                    'M√¥n h·ªçc': a.subject,
                    'Ng√†y h·∫πn': a.date,
                    'Gi·ªù h·∫πn': a.time,
                    'Tr·∫°ng th√°i': isPast ? 'ƒê√£ qua' : 'S·∫Øp t·ªõi',
                    'Ghi ch√∫': a.notes || '',
                    'Ng√†y t·∫°o': formatDateTime(a.createdAt)
                };
            });
            const ws2 = XLSX.utils.json_to_sheet(appointmentsData);
            XLSX.utils.book_append_sheet(wb, ws2, 'L·ªãch H·∫πn');

            // Summary Sheet
            const summaryData = [
                { 'Ch·ªâ s·ªë': 'T·ªïng h·ªçc vi√™n', 'Gi√° tr·ªã': students.length },
                { 'Ch·ªâ s·ªë': 'T·ªïng l·ªãch h·∫πn', 'Gi√° tr·ªã': appointments.length },
                { 'Ch·ªâ s·ªë': 'L·ªãch h·∫πn s·∫Øp t·ªõi', 'Gi√° tr·ªã': getUpcomingAppointments().length },
                { 'Ch·ªâ s·ªë': 'L·ªãch h·∫πn ƒë√£ qua', 'Gi√° tr·ªã': appointments.length - getUpcomingAppointments().length }
            ];
            const ws3 = XLSX.utils.json_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, ws3, 'T·ªïng Quan');

            const fileName = `BaoCao_HocVien_${formatDateForFile()}.xlsx`;
            XLSX.writeFile(wb, fileName);
            showNotification(`‚úÖ ƒê√£ xu·∫•t file: ${fileName}`, 'success');
        }

        function exportStudentsToExcel() {
            if (students.length === 0) {
                showNotification('Kh√¥ng c√≥ h·ªçc vi√™n n√†o ƒë·ªÉ xu·∫•t!', 'error');
                return;
            }

            const studentsData = students.map(s => ({
                'T√™n h·ªçc vi√™n': s.name,
                'Tu·ªïi': s.age,
                'Ph·ª• huynh': s.parentName,
                'S·ªë ƒëi·ªán tho·∫°i': s.parentPhone,
                'Email': s.parentEmail || '',
                'M√¥n h·ªçc': s.subjects.join(', '),
                'S·ªë l·ªãch h·∫πn': appointments.filter(a => a.studentId === s.id).length,
                'Ghi ch√∫': s.notes || '',
                'Ng√†y t·∫°o': formatDateTime(s.createdAt)
            }));

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(studentsData);
            XLSX.utils.book_append_sheet(wb, ws, 'Danh S√°ch H·ªçc Vi√™n');

            const fileName = `DanhSachHocVien_${formatDateForFile()}.xlsx`;
            XLSX.writeFile(wb, fileName);
            showNotification(`‚úÖ ƒê√£ xu·∫•t file: ${fileName}`, 'success');
        }

        function exportAppointmentsToExcel() {
            if (appointments.length === 0) {
                showNotification('Kh√¥ng c√≥ l·ªãch h·∫πn n√†o ƒë·ªÉ xu·∫•t!', 'error');
                return;
            }

            const appointmentsData = appointments.map(a => {
                const student = students.find(s => s.id === a.studentId);
                const isPast = new Date(a.date + ' ' + a.time) < new Date();
                return {
                    'H·ªçc vi√™n': student?.name || 'N/A',
                    'Tu·ªïi': student?.age || 'N/A',
                    'Ph·ª• huynh': student?.parentName || 'N/A',
                    'S·ªë ƒëi·ªán tho·∫°i': student?.parentPhone || 'N/A',
                    'Email': student?.parentEmail || '',
                    'M√¥n h·ªçc': a.subject,
                    'Ng√†y h·∫πn': a.date,
                    'Gi·ªù h·∫πn': a.time,
                    'Tr·∫°ng th√°i': isPast ? 'ƒê√£ qua' : 'S·∫Øp t·ªõi',
                    'Ghi ch√∫': a.notes || '',
                    'Ng√†y t·∫°o l·ªãch': formatDateTime(a.createdAt)
                };
            });

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(appointmentsData);
            XLSX.utils.book_append_sheet(wb, ws, 'L·ªãch H·∫πn');

            const fileName = `LichHen_${formatDateForFile()}.xlsx`;
            XLSX.writeFile(wb, fileName);
            showNotification(`‚úÖ ƒê√£ xu·∫•t file: ${fileName}`, 'success');
        }

        function exportDetailedReport() {
            if (students.length === 0) {
                showNotification('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t!', 'error');
                return;
            }

            const wb = XLSX.utils.book_new();

            const detailedData = students.map(s => {
                const studentAppointments = appointments.filter(a => a.studentId === s.id);
                const upcomingCount = studentAppointments.filter(a => 
                    new Date(a.date + ' ' + a.time) >= new Date()
                ).length;

                return {
                    'T√™n h·ªçc vi√™n': s.name,
                    'Tu·ªïi': s.age,
                    'Ph·ª• huynh': s.parentName,
                    'S·ªë ƒëi·ªán tho·∫°i': s.parentPhone,
                    'Email': s.parentEmail || '',
                    'M√¥n h·ªçc quan t√¢m': s.subjects.join(', '),
                    'T·ªïng l·ªãch h·∫πn': studentAppointments.length,
                    'L·ªãch h·∫πn s·∫Øp t·ªõi': upcomingCount,
                    'L·ªãch h·∫πn ƒë√£ qua': studentAppointments.length - upcomingCount,
                    'Ghi ch√∫': s.notes || '',
                    'Ng√†y ƒëƒÉng k√Ω': formatDateTime(s.createdAt)
                };
            });

            const ws = XLSX.utils.json_to_sheet(detailedData);
            XLSX.utils.book_append_sheet(wb, ws, 'B√°o C√°o Chi Ti·∫øt');

            const fileName = `BaoCaoChiTiet_${formatDateForFile()}.xlsx`;
            XLSX.writeFile(wb, fileName);
            showNotification(`‚úÖ ƒê√£ xu·∫•t file: ${fileName}`, 'success');
        }

        function exportBackupJSON() {
            const backup = {
                version: '3.0',
                exportDate: new Date().toISOString(),
                data: {
                    students: students,
                    appointments: appointments
                }
            };

            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `Backup_HocVien_${formatDateForFile()}.json`;
            link.click();
            URL.revokeObjectURL(url);

            showNotification('‚úÖ ƒê√£ t·∫£i file backup JSON!', 'success');
        }

        function restoreFromJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    if (!backup.data || !backup.data.students || !backup.data.appointments) {
                        throw new Error('File kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng!');
                    }

                    if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën kh√¥i ph·ª•c d·ªØ li·ªáu t·ª´ file n√†y? D·ªØ li·ªáu hi·ªán t·∫°i s·∫Ω b·ªã ghi ƒë√®!')) {
                        return;
                    }

                    students = backup.data.students;
                    appointments = backup.data.appointments;

                    localStorage.setItem('students', JSON.stringify(students));
                    localStorage.setItem('appointments', JSON.stringify(appointments));
                    createAutoBackup();

                    renderAll();
                    showNotification('‚úÖ Kh√¥i ph·ª•c d·ªØ li·ªáu th√†nh c√¥ng!', 'success');
                } catch (error) {
                    showNotification('‚ùå L·ªói: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function clearAllData() {
            const confirmed = confirm('‚ö†Ô∏è C·∫¢NH B√ÅO: B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô d·ªØ li·ªáu?\n\nH√†nh ƒë·ªông n√†y KH√îNG TH·ªÇ HO√ÄN T√ÅC!\n\nNh·∫•n OK ƒë·ªÉ x√°c nh·∫≠n x√≥a.');
            
            if (!confirmed) return;

            const doubleConfirm = prompt('ƒê·ªÉ x√°c nh·∫≠n, vui l√≤ng nh·∫≠p t·ª´ "XOA" (vi·∫øt hoa):');
            
            if (doubleConfirm !== 'XOA') {
                showNotification('ƒê√£ h·ªßy thao t√°c x√≥a', 'info');
                return;
            }

            localStorage.removeItem('students');
            localStorage.removeItem('appointments');
            localStorage.removeItem('backupHistory');
            
            students = [];
            appointments = [];
            backupHistory = [];

            renderAll();
            showNotification('‚úÖ ƒê√£ x√≥a to√†n b·ªô d·ªØ li·ªáu!', 'success');
        }

        // Helper Functions
        function getUpcomingAppointments() {
            const now = new Date();
            return appointments
                .filter(apt => new Date(apt.date + ' ' + apt.time) >= now)
                .sort((a, b) => new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time));
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const days = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];
            return `${days[date.getDay()]} ${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
        }

        function formatDateTime(isoString) {
            const date = new Date(isoString);
            return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
        }

        function formatDateForFile() {
            const now = new Date();
            return `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}`;
        }
    </script>
</body>
</html>